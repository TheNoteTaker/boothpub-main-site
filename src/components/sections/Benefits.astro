---
import { Icon } from '@/components/ui/Icon';
import { createResponsiveImage, type ResponsiveImageOptions } from '@/utils/images';
import { ScrollSection } from '@/components/animations/ScrollSection';
import { IntroSection } from '@/components/animations/IntroSection';
import { BenefitContent } from '@/components/animations/BenefitContent';
import { ScrollProgress } from '@/components/animations/ScrollProgress';
import BenefitImageWrapper from '@/components/animations/BenefitImageWrapper.astro';
import { motion } from 'framer-motion';

const benefits = [
  {
    name: 'Professional Equipment',
    description: 'Studio-quality DSLR cameras with professional lighting for perfect shots every time.',
    icon: 'Camera',
    cta: {
      text: 'View Our Equipment',
      href: '#packages'
    },
    image: {
      src: "https://images.unsplash.com/photo-1542038784456-1ea8e935640e",
      alt: "Professional photo booth equipment setup",
    }
  },
  {
    name: 'Expert Service',
    description: 'Our trained staff provides exceptional service, making every event memorable.',
    icon: 'Award',
    cta: {
      text: 'Meet Our Team',
      href: '#contact'
    },
    image: {
      src: "https://images.unsplash.com/photo-1519671482749-fd09be7ccebf",
      alt: "Professional photo booth attendant helping guests",
    }
  },
  {
    name: 'Premium Experience',
    description: 'Combining photography and bartending for a unique entertainment experience.',
    icon: 'Star',
    cta: {
      text: 'Explore Packages',
      href: '#packages'
    },
    image: {
      src: "https://images.unsplash.com/photo-1516450360452-9312f5e86fc7",
      alt: "Guests enjoying premium photo booth experience",
    }
  },
  {
    name: 'Instant Memories',
    description: 'Take home high-quality prints instantly and access digital copies within 24 hours.',
    icon: 'Image',
    cta: {
      text: 'See Gallery',
      href: '#gallery'
    },
    image: {
      src: "https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3",
      alt: "Instant photo prints from our booth",
    }
  }
];

const imageOptions: ResponsiveImageOptions = {
  width: 500,
  height: 667,
  format: 'webp',
  quality: 85,
  sizes: "(min-width: 1024px) 500px, (min-width: 640px) 400px, 100vw",
  breakpoints: [400, 500, 667]
};

const benefitImages = await Promise.all(
  benefits.map(benefit => createResponsiveImage({
    ...imageOptions,
    src: benefit.image.src,
    alt: benefit.image.alt
  }))
);
---

<section id="benefits" class="bg-white">
  <div class="progress-container relative">
    <ScrollProgress client:load />
  </div>
  <div class="content-container relative">
    <IntroSection client:load>
      <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 text-center">
        <div class="inline-flex mb-4 items-center rounded-full bg-[#F9CC9A]/10 px-4 py-1">
          <Icon name="Sparkles" className="mr-2 h-4 w-4 text-[#D75E1F]" client:load />
          <span class="text-sm font-medium text-[#D75E1F]">Why Choose Us</span>
        </div>
        <h2 class="text-3xl sm:text-4xl font-bold tracking-tight text-[#2F505F] sm:text-5xl">
          Elevate Your Events with Premium Photo Experiences
        </h2>
        <p class="mt-4 text-lg text-muted-foreground max-w-2xl mx-auto">
          We combine professional photography with exceptional service to create unforgettable moments at your events.
        </p>
      </div>
    </IntroSection>

    {benefits.map((benefit, index) => (
      <ScrollSection client:load index={index + 1}>
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-x-24 gap-y-6 sm:gap-y-12 items-center relative pr-4 sm:pr-12 lg:pr-16">
            <BenefitContent
              client:load
              name={benefit.name}
              description={benefit.description}
              icon={benefit.icon}
              cta={benefit.cta}
            />
            <div class="relative w-full h-full max-h-[40vh] sm:max-h-[500px] overflow-hidden rounded-2xl">
              <BenefitImageWrapper
                src={benefitImages[index].images[benefitImages[index].images.length - 1].src}
                alt={benefit.image.alt}
                width={667}
                height={889}
                loading={index === 0 ? "eager" : "lazy"}
                srcset={benefitImages[index].images.map(img => `${img.src} ${img.attributes.width}w`).join(', ')}
                sizes={benefitImages[index].sizes}
              />
            </div>
          </div>
        </div>
      </ScrollSection>
    ))}
  </div>
</section>

<style>
  #benefits {
    contain: layout paint;
    isolation: isolate;
    position: relative;
  }

  .progress-container {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: 4rem;
    pointer-events: none;
    z-index: 100;
  }

  @media (max-width: 768px) {
    .progress-container {
      width: 3rem;
    }
  }
</style>